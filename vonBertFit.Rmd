---
title: "vonBertalanffy model for Groupo Tortuguero data"
output: html_notebook
---

I try to fit von Bertelanffy growth curve to observed growth data of greens. 

```{r}

rm(list=ls())
library(jagsUI)
library(tidyverse)
library(lubridate)
library(reshape)
library(bayesplot)
library(ggridges)

save.rds <- TRUE

source("Mancini_functions.R")

# MCMC.params <- list(   n.chains = 3,
#                        n.samples = 50000,
#                        n.burnin = 30000,
#                        n.thin = 5)

dat.1 <- get.data("data/GTC_20190725_Tomo_v2.csv")

# Lo doesn't have enough (>2) recaptures. 
spp <- c("Cm", "Ei") #unique(dat.1$species)

MCMC.params <- list(n.chains = 3,
                    n.samples = 100000,
                    n.burnin = 60000,
                    n.thin = 5)

```

Find those that were captured more than once: (or better to use more than twice since the dataset is so big?)

```{r}
for (s in 1:length(spp)){
  jags.data <- vonBert.jags.data(dat.1, spp[s])
  
  MCMC.params$model.file <-  "models/Model_RlinfRk_L.txt"
  if (!file.exists(paste0("RData/Rlinf_Rk_", spp[s], ".rds"))){
    parameters <- c('CV', 'k', 'A', 
                    'Linf', 'LinfMu', 'LinfSD', 
                    'Shape', 'rate', #'kAlpha', 'kBeta', 
                    'deviance')
    jm.1 <- jags(data = jags.data$jags.data,
               #inits = inits,
               parameters.to.save= parameters,
               model.file = MCMC.params$model.file,
               n.chains = MCMC.params$n.chains,
               n.burnin = MCMC.params$n.burnin,
               n.thin = MCMC.params$n.thin,
               n.iter = MCMC.params$n.samples,
               DIC = T, 
               parallel=T)
  
  if(save.rds) saveRDS(jm.1, file = paste0("RData/Rlinf_Rk_", spp[s], ".rds"))
  
  } 

  if (!file.exists(paste0("RData/Rlinf_Fk_", spp[s], ".rds"))){
    MCMC.params$model.file <- "models/Model_Rlinf_Fk.txt"
    parameters <- c('CV', 'k', 'A', 
                    'Linf', 'LinfMu', 'LinfSD', 
                    'Shape', 'rate', #'kAlpha', 'kBeta', 
                    'deviance')
    
    jm.2 <- jags(data = jags.data$jags.data,
                 #inits = inits,
                 parameters.to.save= parameters,
                 model.file = MCMC.params$model.file,
                 n.chains = MCMC.params$n.chains,
                 n.burnin = MCMC.params$n.burnin,
                 n.thin = MCMC.params$n.thin,
                 n.iter = MCMC.params$n.samples,
                 DIC = T, 
                 parallel=T)
    
    if(save.rds) saveRDS(jm.2, file = paste0("RData/Rlinf_Fk_", spp[s], ".rds"))
    
  } 
  
  if (!file.exists(paste0("RData/Flinf_Fk_", spp[s], ".rds"))){
    MCMC.params$model.file <- "models/Model_Flinf_Fk.txt"
    parameters <- c('CV', 'k', 'A', 
                    'Linf',  
                    'Shape', 'rate', #'kAlpha', 'kBeta', 
                    'deviance')
    
    jm.3 <- jags(data = jags.data$jags.data,
                 #inits = inits,
               parameters.to.save= parameters,
               model.file = MCMC.params$model.file,
               n.chains = MCMC.params$n.chains,
               n.burnin = MCMC.params$n.burnin,
               n.thin = MCMC.params$n.thin,
               n.iter = MCMC.params$n.samples,
               DIC = T, 
               parallel=T)
  
    if(save.rds) saveRDS(jm.3, file = paste0("RData/Flinf_Fk_", spp[s], ".rds"))
    
  } 
  
  if (!file.exists(paste0("RData/Flinf_Rk_", spp[s], ".rds"))){
    MCMC.params$model.file <- "models/Model_Flinf_Rk.txt"
    parameters <- c('CV', 'k', 'A', 
                    'Linf',  
                    'Shape', 'rate', #'kAlpha', 'kBeta', 
                    'deviance')
    
    jm.4 <- jags(data = jags.data$jags.data,
                 #inits = inits,
                 parameters.to.save= parameters,
                 model.file = MCMC.params$model.file,
                 n.chains = MCMC.params$n.chains,
                 n.burnin = MCMC.params$n.burnin,
                 n.thin = MCMC.params$n.thin,
                 n.iter = MCMC.params$n.samples,
                 DIC = T, 
                 parallel=T)
    
    if(save.rds) saveRDS(jm.4, file = paste0("RData/Flinf_Rk_", spp[s], ".rds"))
    
  } 
}

```

